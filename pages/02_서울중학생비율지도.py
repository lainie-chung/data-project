import streamlit as st
import folium
from streamlit_folium import st_folium
import plotly.graph_objects as go
import pandas as pd

# -------------------------------
# ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ ì¤‘í•™ìƒ ìˆ˜ (ê°€ìƒ ë°ì´í„°)
# -------------------------------
data = {
    "ì§€ì—­": ["ê°•ë‚¨êµ¬", "ì†¡íŒŒêµ¬", "ê°•ì„œêµ¬", "ë…¸ì›êµ¬", "ê´€ì•…êµ¬", "ì€í‰êµ¬", "ê°•ë™êµ¬", "ì„±ë¶êµ¬", "ë„ë´‰êµ¬", "êµ¬ë¡œêµ¬"],
    "ìœ„ë„": [37.5172, 37.5145, 37.5509, 37.6543, 37.4784, 37.6176, 37.5301, 37.5894, 37.6688, 37.4954],
    "ê²½ë„": [127.0473, 127.1066, 126.8495, 127.0568, 126.9516, 126.9227, 127.1238, 127.0182, 127.0463, 126.8877],
    "ë‚¨í•™ìƒ": [5200, 4900, 4700, 4600, 4400, 4200, 4100, 4000, 3800, 3700],
    "ì—¬í•™ìƒ": [5000, 4800, 4600, 4500, 4300, 4100, 4000, 3900, 3700, 3600]
}

df = pd.DataFrame(data)
df["ì´í•©"] = df["ë‚¨í•™ìƒ"] + df["ì—¬í•™ìƒ"]

# -------------------------------
# Streamlit UI
# -------------------------------
st.set_page_config(page_title="ì„œìš¸ ì¤‘í•™ìƒ ë¶„í¬", layout="wide")
st.title("ğŸ“Š ì„œìš¸ì‹œ ì¤‘í•™ìƒ ë¶„í¬ ë° ë‚¨ë…€ ë¹„ìœ¨ ì§€ë„")

# -------------------------------
# ì§€ë„ ìƒì„± (Folium)
# -------------------------------
m = folium.Map(location=[37.55, 126.98], zoom_start=11)

for _, row in df.iterrows():
    popup_text = (
        f"<b>{row['ì§€ì—­']}</b><br>"
        f"ì´ ì¤‘í•™ìƒ ìˆ˜: {row['ì´í•©']:,}ëª…<br>"
        f"ë‚¨í•™ìƒ: {row['ë‚¨í•™ìƒ']:,}ëª…<br>"
        f"ì—¬í•™ìƒ: {row['ì—¬í•™ìƒ']:,}ëª…"
    )
    folium.CircleMarker(
        location=[row["ìœ„ë„"], row["ê²½ë„"]],
        radius=10,
        color="blue",
        fill=True,
        fill_opacity=0.6,
        popup=popup_text,
    ).add_to(m)

st.subheader("ğŸ—ºï¸ ì„œìš¸ì‹œ ì¤‘í•™ìƒ Top10 ì§€ë„")
st_folium(m, width=700, height=500)

# -------------------------------
# ì§€ì—­ ì„ íƒ ë° Plotly ì‹œê°í™”
# -------------------------------
st.subheader("ğŸ“ˆ ì§€ì—­ë³„ ë‚¨ë…€ ë¹„ìœ¨ ë³´ê¸°")

selected_region = st.selectbox("ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”:", df["ì§€ì—­"])

region_data = df[df["ì§€ì—­"] == selected_region].iloc[0]

fig = go.Figure(
    data=[
        go.Pie(
            labels=["ë‚¨í•™ìƒ", "ì—¬í•™ìƒ"],
            values=[region_data["ë‚¨í•™ìƒ"], region_data["ì—¬í•™ìƒ"]],
            marker=dict(colors=["#3A7BD5", "#FF8FAB"]),  # íŒŒë‘/í•‘í¬
            hole=0.3,
        )
    ]
)

fig.update_layout(
    title=f"{selected_region} ë‚¨ë…€ ì¤‘í•™ìƒ ë¹„ìœ¨",
    title_x=0.5,
    font=dict(size=14),
)

st.plotly_chart(fig, use_container_width=True)

# -------------------------------
# ì „ì²´ ìš”ì•½ í…Œì´ë¸”
# -------------------------------
st.subheader("ğŸ“‹ ì„œìš¸ì‹œ ì¤‘í•™ìƒ ìˆ˜ ìš”ì•½ (Top10)")
st.dataframe(df[["ì§€ì—­", "ë‚¨í•™ìƒ", "ì—¬í•™ìƒ", "ì´í•©"]].set_index("ì§€ì—­"))
